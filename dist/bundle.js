(()=>{"use strict";function t(e){if(null==e||!1===e)return document.createTextNode("");if("string"==typeof e||"number"==typeof e||!0===e)return document.createTextNode(e);if(Array.isArray(e)){const s=document.createDocumentFragment();return e.forEach((e=>{s.appendChild(t(e))})),s}const s=document.createElement(e.tag);return e.cls&&[].concat(e.cls).forEach((t=>{s.classList.add(t)})),e.attrs&&Object.keys(e.attrs).forEach((t=>{s.setAttribute(t,e.attrs[t])})),s.appendChild(t(e.content)),s}const e=[{type:"diamonds",rank:"6",uri:"./static/img/cards/6 бубны.svg"},{type:"clubs",rank:"6",uri:"./static/img/cards/6 крести.svg"},{type:"spades",rank:"6",uri:"./static/img/cards/6 пики.svg"},{type:"hearts",rank:"6",uri:"./static/img/cards/6 черви.svg"},{type:"diamonds",rank:"7",uri:"./static/img/cards/7 бубны.svg"},{type:"clubs",rank:"7",uri:"./static/img/cards/7 крести.svg"},{type:"spades",rank:"7",uri:"./static/img/cards/7 пики.svg"},{type:"hearts",rank:"7",uri:"./static/img/cards/7 черви.svg"},{type:"diamonds",rank:"8",uri:"./static/img/cards/8 бубны.svg"},{type:"clubs",rank:"8",uri:"./static/img/cards/8 крести.svg"},{type:"spades",rank:"8",uri:"./static/img/cards/8 пики.svg"},{type:"hearts",rank:"8",uri:"./static/img/cards/8 черви.svg"},{type:"diamonds",rank:"9",uri:"./static/img/cards/9 бубны.svg"},{type:"clubs",rank:"9",uri:"./static/img/cards/9 крести.svg"},{type:"spades",rank:"9",uri:"./static/img/cards/9 пики.svg"},{type:"hearts",rank:"9",uri:"./static/img/cards/9 черви.svg"},{type:"diamonds",rank:"6",uri:"./static/img/cards/10 бубны.svg"},{type:"clubs",rank:"6",uri:"./static/img/cards/10 крести.svg"},{type:"spades",rank:"10",uri:"./static/img/cards/10 пики.svg"},{type:"hearts",rank:"10",uri:"./static/img/cards/10 черви.svg"},{type:"diamonds",rank:"jack",uri:"./static/img/cards/валет бубны.svg"},{type:"clubs",rank:"jack",uri:"./static/img/cards/валет крести.svg"},{type:"spades",rank:"jack",uri:"./static/img/cards/валет пики.svg"},{type:"hearts",rank:"jack",uri:"./static/img/cards/валет черви.svg"},{type:"diamonds",rank:"queen",uri:"./static/img/cards/дама бубны.svg"},{type:"clubs",rank:"queen",uri:"./static/img/cards/дама крести.svg"},{type:"spades",rank:"queen",uri:"./static/img/cards/дама пики.svg"},{type:"hearts",rank:"queen",uri:"./static/img/cards/дама черви.svg"},{type:"diamonds",rank:"king",uri:"./static/img/cards/король бубны.svg"},{type:"clubs",rank:"king",uri:"./static/img/cards/король крести.svg"},{type:"spades",rank:"king",uri:"./static/img/cards/король пики.svg"},{type:"hearts",rank:"king",uri:"./static/img/cards/король черви.svg"},{type:"diamonds",rank:"ace",uri:"./static/img/cards/туз бубны.svg"},{type:"clubs",rank:"ace",uri:"./static/img/cards/туз крести.svg"},{type:"spades",rank:"ace",uri:"./static/img/cards/туз пики.svg"},{type:"hearts",rank:"ace",uri:"./static/img/cards/туз черви.svg"}];document.addEventListener("DOMContentLoaded",(function(){(function(){const s={state:{showedCards:[],timeSec:0,pairsNum:0,diffLevel:-1,stage:""},screens:{lobby:function(){var e,a;clearInterval(s.state.timerInterval);const r=document.querySelector(".app");r&&(r.textContent=""),s.setLayoutClass("lobby"),null==r||r.appendChild(t({tag:"div",cls:"lobby-title",content:"Выбери сложность"})),null==r||r.appendChild(t({tag:"form",content:[{tag:"div",cls:"lobby-levels",content:[{tag:"div",cls:["lobby-levels-item","lobby-levels-item-regular"],content:[{tag:"input",attrs:{type:"radio",name:"diff_levels",value:1}},{tag:"label",content:1,attrs:{for:"diff_levels"}}]},{tag:"div",cls:["lobby-levels-item","lobby-levels-item-regular"],content:[{tag:"input",attrs:{type:"radio",name:"diff_levels",value:2}},{tag:"label",content:2,attrs:{for:"diff_levels"}}]},{tag:"div",cls:["lobby-levels-item","lobby-levels-item-regular"],content:[{tag:"input",attrs:{type:"radio",name:"diff_levels",value:3}},{tag:"label",content:3,attrs:{for:"diff_levels"}}]}]},{tag:"button",cls:"lobby-submit",content:"Старт"}]})),null===(e=null==r?void 0:r.querySelector(".lobby-levels"))||void 0===e||e.addEventListener("click",(function(t){if("INPUT"===t.target.tagName){t.stopPropagation();const e=r.querySelectorAll(".lobby-levels-item input");for(const t of e){const e=t.parentElement;t.checked?(e.classList.remove("lobby-levels-item-regular"),e.classList.add("lobby-levels-item-checked")):(e.classList.remove("lobby-levels-item-checked"),e.classList.add("lobby-levels-item-regular"))}}})),null===(a=null==r?void 0:r.querySelector("form"))||void 0===a||a.addEventListener("submit",(function(t){t.preventDefault();const e=r.querySelectorAll(".lobby-levels-item input");let a=0;for(const t of e)if(t.checked){a=Number(t.value);break}s.state.diffLevel=a,s.renderNextScreen()}))},game:function(){var a;s.state.timeSec=0,s.state.status="",s.state.showedCards=[];const r=document.querySelector(".app");r.textContent="",s.setLayoutClass("game");const n=Number(s.state.diffLevel);r.appendChild(t({tag:"div",cls:"game-header",content:[{tag:"div",cls:"game-timer",content:[{tag:"div",cls:"game-timer-min",content:"00"},{tag:"div",content:"."},{tag:"div",cls:"game-timer-sec",content:"00"}]},{tag:"div",cls:"game-header-actions",content:[{tag:"button",cls:"game-header-actions-restart",content:"Начать заново"}]}]})),null===(a=null==r?void 0:r.querySelector(".game-header-actions-restart"))||void 0===a||a.addEventListener("click",(function(){s.renderScreen("lobby")}));const i=r.appendChild(t({tag:"div",cls:["game-content",`game-content-grid-${n}`]})),c=t=>{var e;t.classList.contains("card-front")&&(null===(e=t.parentElement)||void 0===e||e.classList.add("game-content-card-show"))},o=t=>{var e;t.classList.contains("card-front")&&(null===(e=t.parentElement)||void 0===e||e.classList.remove("game-content-card-show"))};i.addEventListener("click",(t=>{var e;const a=t.target;if(a.classList.contains("card-front")){c(a);const t=a.parentElement,r={rank:t.dataset.cardRank,type:t.dataset.cardType};1===(null===(e=s.state.showedCards)||void 0===e?void 0:e.length)?setTimeout((()=>{if(s.state.showedCards[0].rank===r.rank)s.state.pairsNum--,0===s.state.pairsNum&&(s.state.status="resolved-won",s.renderNextScreen());else{o(a);const t=document.querySelector(`.game-content-card[data-card-rank="${s.state.showedCards[0].rank}"][data-card-type="${s.state.showedCards[0].type}"] .card-front`);o(t),s.state.status="resolved-lost",s.renderNextScreen()}s.state.showedCards=[]}),500):s.state.showedCards.push(r)}}));let l=0;switch(n){case 1:l=8;break;case 2:l=18;break;case 3:l=36}const d=e.sort((()=>Math.random()-.5));let u=[];s.state.pairsNum=0;for(let e=0;e<l;e++){const a=u.indexOf(d[e].rank);a>-1?(u.splice(a,1),s.state.pairsNum++):u.push(d[e].rank),i.appendChild(t({tag:"div",cls:"game-content-card",attrs:{"data-card-type":d[e].type,"data-card-rank":d[e].rank},content:[{tag:"div",cls:"card-front"},{tag:"img",cls:"card-back",attrs:{src:d[e].uri}}]}))}setTimeout((()=>{i.querySelectorAll(".card-front").forEach((t=>{c(t),setTimeout((()=>{o(t)}),5e3)}))}),0),s.state.timerInterval=setInterval((()=>{s.state.timeSec++,r.querySelector(".game-timer-min").innerText=String(Math.floor(s.state.timeSec/60)).padStart(2,"0"),r.querySelector(".game-timer-sec").innerText=String(s.state.timeSec%60).padStart(2,"0")}),1e3)},resolution:function(){var e;s.state.stage="resolution",clearInterval(s.state.timerInterval),document.body.appendChild(t({tag:"div",cls:"resolution",content:[{tag:"div",cls:"resolution-content",content:[{tag:"img",cls:"resolution-content-icon",attrs:{src:"resolved-lost"===s.state.status?"./static/img/lost.png":"./static/img/won.png"}},{tag:"h1",content:"resolved-lost"===s.state.status?"Вы проиграли!":"Вы выиграли!"},{tag:"div",cls:"resolution-content-time",content:[{tag:"span",cls:"resolution-content-time-label",content:"Затраченное время:"},{tag:"span",cls:"resolution-content-time-value",content:`${String(Math.floor(s.state.timeSec/60)).padStart(2,"0")}.${String(s.state.timeSec%60).padStart(2,"0")}`}]},{tag:"button",cls:"resolution-content-actions-restart",content:"Играть снова"}]}]})),null===(e=null===document||void 0===document?void 0:document.querySelector(".resolution-content-actions-restart"))||void 0===e||e.addEventListener("click",(function(){var t;null===(t=null===document||void 0===document?void 0:document.querySelector(".resolution"))||void 0===t||t.remove(),s.renderScreen("lobby")}))}},renderScreen:function(t){if(!t)throw new Error("Требуется передать наименование экрана");if(!this.screens[t])throw new Error(`Экрана ${t} не существует`);this.state.stage=t,this.screens[t]()},renderNextScreen:function(){"lobby"===this.state.stage?this.renderScreen("game"):"game"!==this.state.stage||"resolved-lost"!==this.state.status&&"resolved-won"!==this.state.status||this.renderScreen("resolution")},setLayoutClass:function(t){const e=document.querySelector(".app");e.dataset.specialClass&&e.classList.remove(e.dataset.specialClass),e.classList.add(t),e.dataset.specialClass=t}};return s.screens.lobby.bind(s),s.screens.game.bind(s),s.screens.resolution.bind(s),s})().renderScreen("lobby")}))})();